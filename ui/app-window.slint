import "../assets/fonts/Lilex/Lilex-Regular.ttf";
import "../assets/fonts/Lilex/Lilex-Bold.ttf";
import "../assets/fonts/Lilex/Lilex-Italic.ttf";
import { Palette } from "palette.slint";
import { Button } from "std-widgets.slint";

export component TestWindow inherits Window {
    preferred-width: 1280px;
    preferred-height: 720px;
    min-width: 1px;
    min-height: 1px;
    max-width: 99999px;
    max-height: 99999px;
    default-font-family: "Lilex";
    GridLayout {
        Rectangle {
            background: Palette.green;
            width: 72px;
        }

        Rectangle {
            background: Palette.blue;
            width: 250px;
        }

        Rectangle {
            background: Palette.yellow;
            GridLayout {
                Rectangle {
                    row: 0;
                    background: Palette.orange;
                }

                Rectangle {
                    row: 1;
                    background: Palette.purple;
                    height: 100px;
                    HorizontalLayout {
                        padding: 10px;
                        Rectangle {
                            background: Palette.grey;
                            HorizontalLayout {
                                spacing: 10px;
                                alignment: start;
                                Rectangle {
                                    background: Palette.red;
                                    width: 32px;
                                    height: 32px;
                                }

                                Rectangle {
                                    background: Palette.red;
                                    width: 32px;
                                    height: 32px;
                                }

                                Rectangle {
                                    background: Palette.red;
                                    width: 32px;
                                    height: 32px;
                                }
                            }
                        }
                    }
                }
            }
        }

        Rectangle {
            background: Palette.red;
            width: 225px;
        }
    }
}

export component AppWindow inherits Window {
    preferred-width: 1280px;
    preferred-height: 720px;
    min-width: 1px;
    min-height: 1px;
    max-width: 99999px;
    max-height: 99999px;
    default-font-family: "Lilex";
    no-frame: true;
    resize-border-width: 10px;
    callback start-window-drag();
    callback maximize-window();
    callback close-window();
    callback minimize-window();

    // Sidebar width properties
    in-out property <length> left-sidebar-width: 74px;
    in-out property <length> second-sidebar-width: 250px;
    in-out property <length> right-sidebar-width: 225px;

    // Resizer state for tracking drag operations
    property <length> second-press-x;
    property <length> second-press-width;
    property <length> right-press-x;
    property <length> right-press-width;
    Rectangle {
        background: Palette.background;
        VerticalLayout {
            // Top app bar
            Rectangle {
                height: 32px;
                border-width: 0.5px;
                border-color: Palette.border;
                background: Palette.background-darker;
                TouchArea {
                    width: 100%;
                    height: 100%;
                    pointer-event(event) => {
                        if (event.kind == PointerEventKind.down) {
                            root.start-window-drag();
                        }
                    }
                    double-clicked => {
                        root.maximize-window();
                    }
                }

                HorizontalLayout {
                    // Left side of the app bar
                    VerticalLayout {
                        alignment: center;
                        padding-left: 10px;
                        Text {
                            text: "ezChat";
                        }
                    }

                    // Right side of the app bar
                    VerticalLayout {
                        alignment: center;
                        HorizontalLayout {
                            // Minimize button
                            Rectangle {
                                background: ta-minimize.pressed ? Palette.minimize-btn-pressed : (ta-minimize.has-hover ? Palette.selection : transparent);
                                width: 32px;
                                height: 32px;
                                Image {
                                    source: @image-url("../assets/icons/minus.svg");
                                    colorize: Palette.foreground;
                                    height: 15px;
                                    width: 15px;
                                }

                                ta-minimize := TouchArea {
                                    clicked => {
                                        root.minimize-window();
                                    }
                                }
                            }

                            // Maximize button
                            Rectangle {
                                background: ta-maximize.pressed ? Palette.maximize-btn-pressed : (ta-maximize.has-hover ? Palette.yellow : transparent);
                                width: 32px;
                                height: 32px;
                                Image {
                                    source: @image-url("../assets/icons/maximize.svg");
                                    colorize: ta-maximize.has-hover ? Palette.black : Palette.foreground;
                                    height: 12px;
                                    width: 12px;
                                }

                                ta-maximize := TouchArea {
                                    clicked => {
                                        root.maximize-window();
                                    }
                                }
                            }

                            // Close button
                            Rectangle {
                                background: ta-close.pressed ? Palette.close-btn-pressed : (ta-close.has-hover ? Palette.red : transparent);
                                width: 32px;
                                height: 32px;
                                Image {
                                    source: @image-url("../assets/icons/x.svg");
                                    colorize: ta-close.has-hover ? Palette.black : Palette.foreground;
                                    height: 15px;
                                    width: 15px;
                                }

                                ta-close := TouchArea {
                                    clicked => {
                                        root.close-window();
                                    }
                                }
                            }
                        }
                    }
                }
            }

            // Main window content
            HorizontalLayout {
                // Left sidebar 
                Rectangle {
                    width: 74px;
                    border-width: 0.5px;
                    border-color: Palette.border;
                    background: Palette.background-darker;
                }

                // Second left sidebar
                Rectangle {
                    width: root.second-sidebar-width;
                    border-width: 0.5px;
                    border-color: Palette.border;
                    background: Palette.background-dark;
                    VerticalLayout {
                        // Channels list
                        Rectangle {
                            border-width: 0.5px;
                            border-color: Palette.border;
                            background: Palette.background-dark;
                        }

                        // Controls bar
                        Rectangle {
                            height: 80px;
                            border-width: 0.5px;
                            border-color: Palette.border;
                            background: Palette.background-darker;
                        }
                    }
                }

                // Resizer for second sidebar
                Rectangle {
                    width: 2px;
                    background: ta-second.has-hover ? Palette.yellow : transparent;
                    ta-second := TouchArea {
                        width: 100%;
                        height: 100%;
                        mouse-cursor: ew-resize;
                        moved => {
                            if (self.pressed) {
                                root.second-sidebar-width = max(150px, min(400px, root.second-sidebar-width + self.mouse-x - root.second-press-x));
                            }
                        }
                        pointer-event(event) => {
                            if (event.kind == PointerEventKind.down) {
                                root.second-press-x = self.mouse-x;
                                root.second-press-width = root.second-sidebar-width;
                            }
                        }
                    }
                }

                // Main content
                Rectangle {
                    border-width: 0.5px;
                    border-color: Palette.border;
                    background: Palette.background;
                    VerticalLayout {
                        // Chat
                        Rectangle {
                            border-width: 0.5px;
                            border-color: Palette.border;
                        }
                        // Message input
                        HorizontalLayout {
                            padding: 10px;
                            Rectangle {
                                height: 46px;
                                border-width: 0.6px;
                                border-color: Palette.border-dark;
                                background: Palette.background-dark;
                                HorizontalLayout {
                                    alignment: start;
                                    Rectangle {
                                        width: 32px;
                                        height: 32px;
                                        background: Palette.background-darker;
                                    }

                                    Rectangle {
                                        width: 32px;
                                        height: 32px;
                                        background: Palette.border-dark;
                                    }
                                }
                            }
                        }
                    }
                }
                // Resizer for right sidebar
                Rectangle {
                    width: 2px;
                    background: ta-right.has-hover ? Palette.yellow : transparent;
                    ta-right := TouchArea {
                        width: 100%;
                        height: 100%;
                        mouse-cursor: ew-resize;
                        moved => {
                            if (self.pressed) {
                                root.right-sidebar-width = max(150px, min(400px, root.right-sidebar-width - (self.mouse-x - root.right-press-x)));
                            }
                        }
                        pointer-event(event) => {
                            if (event.kind == PointerEventKind.down) {
                                root.right-press-x = self.mouse-x;
                                root.right-press-width = root.right-sidebar-width;
                            }
                        }
                    }
                }

                // Right sidebar
                Rectangle {
                    width: root.right-sidebar-width;
                    border-width: 0.5px;
                    border-color: Palette.border;
                    background: Palette.background-darker;
                }
            }
        }

        // Window border
        Rectangle {
            border-width: 1px;
            border-color: Palette.window-border;
        }
    }
}
